<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Duties Multi-Sheet Viewer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: 40px auto; padding: 20px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 10px; }
    h1 { text-align: center; margin-bottom: 25px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
    .tab-btn {
      padding: 10px 24px;
      border: none;
      background: #4CAF50;
      color: white;
      border-radius: 7px 7px 0 0;
      cursor: pointer;
      font-size: 16px;
      outline: none;
      transition: background 0.15s;
    }
    .tab-btn.active { background: #388E3C; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
    th { background: #4CAF50; color: white; position: sticky; top: 0; }
    tr:nth-child(even) { background: #f2f2f2; }
    .loading { text-align: center; color: #777; margin-top: 20px; }
    @media (max-width: 700px) {
      .container { padding: 2px; }
      table { font-size: 12px; }
      th, td { padding: 5px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Task Duties - All Sheets Dashboard</h1>
    <div class="tabs" id="tabs"></div>
    <div id="sheetContents"></div>
    <p style="text-align:center;font-size:12px;color:#777;">Auto-refreshes every 60 seconds</p>
  </div>
  <script>
    // Sheet Info: Add GIDs and display names here
    const SHEET_ID = "1_A9bJiSV_-jsum3QLFX1UE0wkbxukvG9IORSwK1Agiw";
    const SHEETS = [
      { name: "Dashboard", gid: "1134492562" },
      { name: "SIs",       gid: "701335861" },
      { name: "PC & HCs",  gid: "0" },
      { name: "Tappal",    gid: "1306446965" }
    ];
    const REFRESH_INTERVAL = 60000; // ms

    // Setup tabs
    function setupTabs() {
      const tabsDiv = document.getElementById('tabs');
      tabsDiv.innerHTML = '';
      SHEETS.forEach((sheet, i) => {
        const btn = document.createElement('button');
        btn.className = 'tab-btn' + (i === 0 ? ' active' : '');
        btn.textContent = sheet.name;
        btn.onclick = () => switchTab(i);
        tabsDiv.appendChild(btn);
      });
    }

    // Switch tab and show respective content
    function switchTab(idx) {
      document.querySelectorAll('.tab-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === idx);
      });
      document.querySelectorAll('.tab-content').forEach((tab, i) => {
        tab.classList.toggle('active', i === idx);
      });
    }

    // Fetch and render all sheets
    async function fetchAllSheets() {
      const container = document.getElementById('sheetContents');
      container.innerHTML = '';
      await Promise.all(SHEETS.map(async (sheet, idx) => {
        // Create tab content container
        const tabDiv = document.createElement('div');
        tabDiv.className = 'tab-content' + (idx === 0 ? ' active' : '');
        tabDiv.id = 'tab-' + idx;
        tabDiv.innerHTML = `<div class="loading">Loading ${sheet.name}...</div>`;
        container.appendChild(tabDiv);

        // Fetch data
        try {
          const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${sheet.gid}`;
          const res = await fetch(url + "&t=" + Date.now());
          const text = await res.text();
          const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));
          const cols = json.table.cols.map(c => c.label || "");
          const rows = json.table.rows.map(r =>
            r.c.map(cell => cell ? (cell.f ? cell.f : cell.v) : "")
          );

          // Render table
          const table = document.createElement('table');
          const thead = table.createTHead();
          const headRow = thead.insertRow();
          cols.forEach(col => {
            const th = document.createElement('th');
            th.textContent = col;
            headRow.appendChild(th);
          });
          const tbody = table.createTBody();
          rows.forEach(row => {
            const tr = tbody.insertRow();
            row.forEach(cell => {
              const td = tr.insertCell();
              td.textContent = cell;
            });
          });

          tabDiv.innerHTML = '';
          tabDiv.appendChild(table);

        } catch (e) {
          tabDiv.innerHTML = `<div class="loading">Failed to load ${sheet.name}</div>`;
        }
      }));
    }

    // Main init
    function init() {
      setupTabs();
      fetchAllSheets();
    }

    init();
    setInterval(fetchAllSheets, REFRESH_INTERVAL);
  </script>
</body>
</html>
